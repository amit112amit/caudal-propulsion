import numba
import numpy as np
from math import sqrt, sin, cos, acos, atan2

@numba.njit
def jacobian(c, t, yin, yp, R, L1, L2, H, Ct, Cdv, Cd, St, Sv, rho, Ma, Mv, Iv, theta):
    """Calculates the jacobian of the system of equations G(t, y, yp) == 0."""
    x,y,p,x1,y1,p1 = yin
    x2,y2,p2 = yp[3:6]
    t1,dt1,ddt1,t2,dt2,ddt2 = theta(t)
    # Test direction of Vn1
    r1 = 0.5*L1
    Vn1 = (-R*sin(p)*p1 - r1*(p1 + dt1)*sin(p + t1) + x1)*sin(p + t1) - (R*cos(p)*p1 + r1*(p1 + dt1)*cos(p + t1) + y1)*cos(p + t1)
    s1 = 1.0 if Vn1 > 0 else -1.0
    # Test direction of Vn2
    r2 = 0.5*L2    
    Vn2 = (-L1*(p1 + dt1)*sin(p + t1) - R*sin(p)*p1 - r2*(p1 + dt1 + dt2)*sin(p + t1 + t2) + x1)*sin(p + t1 + t2) - (L1*(p1 + dt1)*cos(p + t1) + R*cos(p)*p1 + r2*(p1 + dt1 + dt2)*cos(p + t1 + t2) + y1)*cos(p + t1 + t2)
    s2 = 1.0 if Vn2 > 0 else -1.0
    s3 = 1.0 if p1 > 0 else -1.0
    Z1 = 0.5*rho*Cd*H
    Z2 = 0.5*rho*Cdv*Sv
    Z3 = 0.5*rho*Ct*St

    # Now calculate the jacobian
    dfdy = np.zeros((6, 6))
    dfdyp = np.zeros((6, 6))
    dfdy[0,3] = -1.0
    dfdy[1,4] = -1.0
    dfdy[2,5] = -1.0

    dfdyp[0,0] = 1.0
    dfdyp[1,1] = 1.0
    dfdyp[2,2] = 1.0

    # First calculate the common sub-expressions
    term0 = L1**2
    term1 = p + t1
    term2 = cos(term1)
    term3 = term2**3
    term4 = Ma*term3
    term5 = (1/2)*term4
    term6 = ddt1*term5
    term7 = p2*term5
    term8 = sin(term1)
    term9 = term8**3
    term10 = Ma*term9
    term11 = dt1*term10
    term12 = p1*term11
    term13 = dt1**2
    term14 = (1/2)*Ma
    term15 = term14*term9
    term16 = term13*term15
    term17 = p1**2
    term18 = term15*term17
    term19 = term8**2
    term20 = Ma*term19
    term21 = (1/2)*term2*term20
    term22 = ddt1*term21
    term23 = p2*term21
    term24 = term2**2
    term25 = Ma*term24
    term26 = dt1*term25
    term27 = term26*term8
    term28 = p1*term27
    term29 = (1/2)*term25*term8
    term30 = term13*term29
    term31 = term17*term29
    term32 = term0*(-term12 - term16 - term18 + term22 + term23 - term28 - term30 - term31 + term6 + term7)
    term33 = L1**3
    term34 = Z1*dt1
    term35 = s1*term2**5
    term36 = (2/3)*term35
    term37 = term34*term36
    term38 = p1*term37
    term39 = (1/3)*Z1
    term40 = term13*term39
    term41 = term35*term40
    term42 = term17*term39
    term43 = term35*term42
    term44 = s1*term8**4
    term45 = term34*term44
    term46 = (2/3)*term2
    term47 = term45*term46
    term48 = p1*term47
    term49 = term2*term44
    term50 = term40*term49
    term51 = term42*term49
    term52 = (4/3)*term34
    term53 = s1*term3
    term54 = term19*term53
    term55 = term52*term54
    term56 = p1*term55
    term57 = Z1*term13
    term58 = (2/3)*term19
    term59 = term53*term57*term58
    term60 = Z1*term17
    term61 = term53*term60
    term62 = term58*term61
    term63 = term33*(-term38 - term41 - term43 - term48 - term50 - term51 - term56 - term59 - term62)
    term64 = Ma*y2
    term65 = term24*term64
    term66 = dt1*term20
    term67 = term66*x1
    term68 = term26*x1
    term69 = p1*term20
    term70 = term69*x1
    term71 = p1*term25
    term72 = term71*x1
    term73 = Ma*term8
    term74 = term2*term73
    term75 = term74*x2
    term76 = cos(p)
    term77 = R*term76
    term78 = term25*term77
    term79 = p2*term78
    term80 = 4*y1
    term81 = dt1*term74
    term82 = p1*term80
    term83 = sin(p)
    term84 = R*term83
    term85 = term26*term84
    term86 = p1*term85
    term87 = term66*term84
    term88 = p1*term87
    term89 = term74*term84
    term90 = p2*term89
    term91 = term20*term84
    term92 = term17*term91
    term93 = 2*term77
    term94 = term81*term93
    term95 = p1*term94
    term96 = term74*term77
    term97 = term17*term96
    term98 = L1*(-term19*term64 + term65 + 2*term67 - 2*term68 + 2*term70 - 2*term72 - term74*term82 - 2*term75 + term79 - term80*term81 + term86 - term88 + term90 - term92 - term95 - term97)
    term99 = s1*term9
    term100 = Z1*term99
    term101 = x1*y1
    term102 = 2*term101
    term103 = y1**2
    term104 = Z1*term103
    term105 = term104*term53
    term106 = 2*term84
    term107 = Z1*p1
    term108 = term106*term107
    term109 = term108*term99
    term110 = term107*term93
    term111 = term110*term53
    term112 = term111*y1
    term113 = term24*term8
    term114 = s1*term113
    term115 = 4*Z1*term101
    term116 = x1**2
    term117 = Z1*term116
    term118 = s1*term117
    term119 = term19*term2
    term120 = term118*term119
    term121 = s1*term104
    term122 = 2*term119
    term123 = s1*term107
    term124 = 4*x1
    term125 = term123*term124
    term126 = term119*term84
    term127 = term113*term77
    term128 = term106*term123
    term129 = term113*term128
    term130 = term129*y1
    term131 = term123*term93
    term132 = term119*term131
    term133 = R**2
    term134 = term133*term76**2
    term135 = term134*term61
    term136 = term133*term83**2
    term137 = term136*term60
    term138 = s1*term119
    term139 = term137*term138
    term140 = 2*term113
    term141 = term133*term76*term83
    term142 = term141*term60
    term143 = s1*term142
    term144 = term140*term143
    term145 = L1*(-term100*term102 - term105 + term109*y1 - term112 + term114*term115 - 3*term120 + term121*term122 + term125*term126 + term125*term127 - term130 + term132*y1 - term135 - term139 - term144)
    term146 = L2**2
    term147 = t2 + term1
    term148 = cos(term147)
    term149 = term148**3
    term150 = Ma*term149
    term151 = (1/2)*term150
    term152 = ddt1*term151
    term153 = ddt2*term151
    term154 = p2*term151
    term155 = sin(term147)
    term156 = term155**3
    term157 = Ma*term156
    term158 = dt1*term157
    term159 = dt2*term158
    term160 = p1*term158
    term161 = dt2*term157
    term162 = p1*term161
    term163 = term14*term156
    term164 = term13*term163
    term165 = dt2**2
    term166 = term163*term165
    term167 = term163*term17
    term168 = term155**2
    term169 = Ma*term168
    term170 = (1/2)*term148*term169
    term171 = ddt1*term170
    term172 = ddt2*term170
    term173 = p2*term170
    term174 = term148**2
    term175 = Ma*term174
    term176 = dt1*term175
    term177 = term155*term176
    term178 = dt2*term177
    term179 = p1*term177
    term180 = dt2*term175
    term181 = term155*term180
    term182 = p1*term181
    term183 = (1/2)*term155*term175
    term184 = term13*term183
    term185 = term165*term183
    term186 = term17*term183
    term187 = term146*(term152 + term153 + term154 - term159 - term160 - term162 - term164 - term166 - term167 + term171 + term172 + term173 - term178 - term179 - term182 - term184 - term185 - term186)
    term188 = term107*term44
    term189 = s1*term2**4
    term190 = term189*term34
    term191 = term190*y1
    term192 = term107*term189
    term193 = term192*y1
    term194 = term190*term77
    term195 = p1*term194
    term196 = term60*term77
    term197 = term189*term196
    term198 = term53*term8
    term199 = term198*term34
    term200 = term199*x1
    term201 = term2*term99
    term202 = term201*term34
    term203 = term202*x1
    term204 = term107*term198
    term205 = term204*x1
    term206 = term107*term201
    term207 = term206*x1
    term208 = term199*term84
    term209 = p1*term208
    term210 = term202*term84
    term211 = p1*term210
    term212 = term60*term84
    term213 = term198*term212
    term214 = term201*term212
    term215 = s1*term34
    term216 = term19*term24
    term217 = term215*term216
    term218 = term217*term77
    term219 = p1*term218
    term220 = s1*term216
    term221 = term196*term220
    term222 = term0*(term188*y1 - term191 - term193 - term195 - term197 + 2*term200 + 2*term203 + 2*term205 + 2*term207 - term209 - term211 - term213 - term214 - term219 - term221 + term45*y1)
    term223 = L2**3
    term224 = s2*term148**5
    term225 = (2/3)*term224
    term226 = term225*term34
    term227 = dt2*term226
    term228 = p1*term226
    term229 = term107*term225
    term230 = dt2*term229
    term231 = term224*term40
    term232 = term165*term39
    term233 = term224*term232
    term234 = term224*term42
    term235 = s2*term155**4
    term236 = term235*term34
    term237 = (2/3)*term148
    term238 = term236*term237
    term239 = dt2*term238
    term240 = p1*term238
    term241 = term107*term235
    term242 = term237*term241
    term243 = dt2*term242
    term244 = Z1*term235
    term245 = term13*term244
    term246 = (1/3)*term148
    term247 = term245*term246
    term248 = term244*term246
    term249 = term165*term248
    term250 = term17*term248
    term251 = s2*term149
    term252 = term168*term251
    term253 = term252*term52
    term254 = dt2*term253
    term255 = p1*term253
    term256 = (4/3)*term107
    term257 = term252*term256
    term258 = dt2*term257
    term259 = (2/3)*term168
    term260 = term251*term259
    term261 = term260*term57
    term262 = Z1*term165
    term263 = term260*term262
    term264 = term251*term60
    term265 = term259*term264
    term266 = term223*(-term227 - term228 - term230 - term231 - term233 - term234 - term239 - term240 - term243 - term247 - term249 - term250 - term254 - term255 - term258 - term261 - term263 - term265)
    term267 = term174*term64
    term268 = dt1*term169
    term269 = term268*x1
    term270 = term176*x1
    term271 = dt2*term169
    term272 = term271*x1
    term273 = term180*x1
    term274 = p1*term169
    term275 = term274*x1
    term276 = p1*term175
    term277 = term276*x1
    term278 = term175*term77
    term279 = p2*term278
    term280 = term148*term155
    term281 = Ma*term280
    term282 = term281*x2
    term283 = term176*term84
    term284 = p1*term283
    term285 = term180*term84
    term286 = p1*term285
    term287 = L1*term2
    term288 = term175*term287
    term289 = ddt1*term288
    term290 = p2*term288
    term291 = term281*term80
    term292 = term268*term84
    term293 = p1*term292
    term294 = term271*term84
    term295 = p1*term294
    term296 = term169*term84
    term297 = term17*term296
    term298 = L1*term8
    term299 = dt2*term298
    term300 = term176*term299
    term301 = term180*term298
    term302 = p1*term301
    term303 = term281*term84
    term304 = p2*term303
    term305 = term268*term299
    term306 = 2*term298
    term307 = term268*term306
    term308 = p1*term307
    term309 = term271*term298
    term310 = p1*term309
    term311 = term169*term298
    term312 = term13*term311
    term313 = term17*term311
    term314 = term281*term298
    term315 = ddt1*term314
    term316 = p2*term314
    term317 = dt1*term281
    term318 = p1*term93
    term319 = term317*term318
    term320 = dt2*term281
    term321 = term318*term320
    term322 = term281*term77
    term323 = term17*term322
    term324 = 2*term287
    term325 = term317*term324
    term326 = dt2*term325
    term327 = p1*term325
    term328 = term320*term324
    term329 = p1*term328
    term330 = term281*term287
    term331 = term13*term330
    term332 = term17*term330
    term333 = L2*(-dt1*term291 - dt2*term291 - term168*term64 + term267 + 2*term269 - 2*term270 + 2*term272 - 2*term273 + 2*term275 - 2*term277 + term279 - term281*term82 - 2*term282 + term284 + term286 + term289 + term290 - term293 - term295 - term297 + term300 + term302 + term304 - term305 - term308 - term310 - term312 - term313 + term315 + term316 - term319 - term321 - term323 - term326 - term327 - term329 - term331 - term332)
    term334 = dt2*term244
    term335 = s2*term148**4
    term336 = term335*term34
    term337 = term336*y1
    term338 = Z1*term335
    term339 = dt2*term338
    term340 = term339*y1
    term341 = term107*term335
    term342 = term341*y1
    term343 = term336*term77
    term344 = p1*term343
    term345 = dt2*term77
    term346 = term341*term345
    term347 = term17*term338
    term348 = term347*term77
    term349 = term155*term251
    term350 = term34*term349
    term351 = term350*x1
    term352 = s2*term156
    term353 = term148*term352
    term354 = term34*term353
    term355 = term354*x1
    term356 = Z1*x1
    term357 = 2*term356
    term358 = term352*term357
    term359 = term107*term349
    term360 = term359*x1
    term361 = term107*term353
    term362 = term361*x1
    term363 = dt2*term287
    term364 = term336*term363
    term365 = term324*term336
    term366 = p1*term365
    term367 = term341*term363
    term368 = term287*term338
    term369 = term13*term368
    term370 = term17*term368
    term371 = term350*term84
    term372 = p1*term371
    term373 = term354*term84
    term374 = p1*term373
    term375 = dt2*term84
    term376 = term359*term375
    term377 = term361*term375
    term378 = term212*term349
    term379 = term212*term353
    term380 = term299*term350
    term381 = term299*term354
    term382 = term306*term350
    term383 = p1*term382
    term384 = term306*term354
    term385 = p1*term384
    term386 = term299*term359
    term387 = term299*term361
    term388 = s2*term34
    term389 = term168*term174
    term390 = term388*term389
    term391 = term390*term77
    term392 = p1*term391
    term393 = s2*term389
    term394 = term107*term393
    term395 = term345*term394
    term396 = term298*term57
    term397 = term349*term396
    term398 = term353*term396
    term399 = term298*term60
    term400 = term349*term399
    term401 = term353*term399
    term402 = term196*term393
    term403 = term363*term390
    term404 = term324*term390
    term405 = p1*term404
    term406 = term363*term394
    term407 = term287*term393
    term408 = term407*term57
    term409 = term407*term60
    term410 = term146*(dt2*term148*term358 + dt2*term349*term357 + term236*y1 + term241*y1 + term334*y1 - term337 - term340 - term342 - term344 - term346 - term348 + 2*term351 + 2*term355 + 2*term360 + 2*term362 - term364 - term366 - term367 - term369 - term370 - term372 - term374 - term376 - term377 - term378 - term379 - term380 - term381 - term383 - term385 - term386 - term387 - term392 - term395 - term397 - term398 - term400 - term401 - term402 - term403 - term405 - term406 - term408 - term409)
    term411 = Z1*term102
    term412 = term104*term251
    term413 = term108*term352
    term414 = term110*term251
    term415 = term414*y1
    term416 = term155*term174
    term417 = s2*term115
    term418 = term306*term352
    term419 = term34*term418
    term420 = term251*term324
    term421 = term34*term420
    term422 = term421*y1
    term423 = term107*term418
    term424 = term107*term420
    term425 = term424*y1
    term426 = s2*term117
    term427 = term148*term168
    term428 = term426*term427
    term429 = s2*term104
    term430 = 2*term427
    term431 = term134*term264
    term432 = s2*term427
    term433 = term107*term432
    term434 = term433*term84
    term435 = s2*term416
    term436 = term107*term435
    term437 = term436*term77
    term438 = term108*term435
    term439 = term438*y1
    term440 = term110*term432
    term441 = term421*term77
    term442 = p1*term441
    term443 = term0*term24
    term444 = term251*term443
    term445 = 2*p1
    term446 = term34*term445
    term447 = term444*term446
    term448 = term264*term324*term77
    term449 = term444*term57
    term450 = term444*term60
    term451 = term388*term427
    term452 = term124*term298
    term453 = term124*term287
    term454 = term388*term416
    term455 = term306*term388
    term456 = term416*term455
    term457 = term456*y1
    term458 = term324*term388
    term459 = term427*term458
    term460 = term306*term435
    term461 = term107*term460
    term462 = term461*y1
    term463 = term107*term324
    term464 = term432*term463
    term465 = term137*term432
    term466 = 2*term416
    term467 = s2*term466
    term468 = term142*term467
    term469 = term427*term455
    term470 = term469*term84
    term471 = p1*term470
    term472 = p1*term106
    term473 = term287*term472
    term474 = term454*term473
    term475 = term456*term77
    term476 = p1*term475
    term477 = term0*term19
    term478 = term445*term451*term477
    term479 = term306*term432
    term480 = term212*term479
    term481 = term287*term60
    term482 = term106*term481
    term483 = term435*term482
    term484 = term196*term460
    term485 = term432*term477
    term486 = term485*term57
    term487 = term485*term60
    term488 = term2*term8
    term489 = term0*term488
    term490 = 4*term489
    term491 = term454*term490
    term492 = p1*term491
    term493 = term467*term489
    term494 = term493*term57
    term495 = term493*term60
    term496 = L2*(term124*term434 + term124*term437 - term352*term411 - term412 + term413*y1 - term415 + term416*term417 + term419*y1 - term422 + term423*y1 - term425 - 3*term428 + term429*term430 - term431 + term433*term452 + term436*term453 - term439 + term440*y1 - term442 - term447 - term448 - term449 - term450 + term451*term452 + term453*term454 - term457 + term459*y1 - term462 + term464*y1 - term465 - term468 - term471 - term474 - term476 - term478 - term480 - term483 - term484 - term486 - term487 - term492 - term494 - term495)
    term497 = sqrt(term103 + term116)
    term498 = Z2*term497
    term499 = Z2/term497
    term500 = 2*dt1
    term501 = term500*term74
    term502 = term445*term74
    term503 = L1*(-term501 - term502)
    term504 = term281*term500
    term505 = 2*term281
    term506 = dt2*term505
    term507 = term281*term445
    term508 = L2*(-term504 - term506 - term507)
    term509 = term107*term220
    term510 = term217 + term509
    term511 = term0*(term188 + term45 + term510)
    term512 = Z1*y1
    term513 = 2*term512
    term514 = s1*term513
    term515 = L1*(term109 + term119*term514 + term132 - term357*term99)
    term516 = Z1*dt2
    term517 = term393*term516
    term518 = term390 + term394 + term517
    term519 = term146*(term236 + term241 + term334 + term518)
    term520 = s2*term513
    term521 = L2*(-term358 + term413 + term419 + term423 + term427*term520 + term440 + term459 + term464)
    term522 = L1*(term26 - term66 - term69 + term71)
    term523 = term0*(-term199 - term202 - term204 - term206)
    term524 = L2*(term176 + term180 - term268 - term271 - term274 + term276)
    term525 = s1*term357
    term526 = term119*term128
    term527 = term113*term131
    term528 = L1*(-term113*term514 + term119*term525 - term526 - term527)
    term529 = term349*term516
    term530 = term353*term516
    term531 = term146*(-term350 - term354 - term359 - term361 - term529 - term530)
    term532 = s2*term357
    term533 = term108*term432
    term534 = term110*term435
    term535 = term416*term458
    term536 = term107*term479
    term537 = term435*term463
    term538 = L2*(-term416*term520 + term427*term532 - term469 - term533 - term534 - term535 - term536 - term537)
    term539 = term101*term499 - term522 - term523 - term524 - term528 - term531 - term538
    term540 = dt1*term4
    term541 = term2*term66
    term542 = term0*(p1*term4 + term2*term69 + term540 + term541)
    term543 = dt1*term150
    term544 = dt2*term150
    term545 = term148*term268
    term546 = term148*term271
    term547 = term146*(p1*term150 + term148*term274 + term543 + term544 + term545 + term546)
    term548 = term8**5
    term549 = (2/3)*term548
    term550 = term215*term549
    term551 = (2/3)*term8
    term552 = term190*term551
    term553 = term24*term99
    term554 = term52*term553
    term555 = term33*(-term123*term549 - term192*term551 - term256*term553 - term550 - term552 - term554)
    term556 = 2*term74
    term557 = term26*term77
    term558 = term66*term77
    term559 = term106*term81
    term560 = L1*(-term20*y1 + term25*y1 + term472*term74 - term556*x1 + term557 - term558 + term559 + term71*term93)
    term561 = term106*term356
    term562 = 2*term107
    term563 = term136*term562
    term564 = term356*term93
    term565 = term106*term512
    term566 = term512*term93
    term567 = 4*term141
    term568 = term123*term567
    term569 = L1*(-term114*term566 - term119*term568 - term123*term134*term140 + term138*term564 - term138*term565 + term561*term99 - term563*term99)
    term570 = term155**5
    term571 = (2/3)*term570
    term572 = term388*term571
    term573 = s2*term571
    term574 = term107*term573
    term575 = (2/3)*term155
    term576 = term336*term575
    term577 = term341*term575
    term578 = term174*term352
    term579 = term52*term578
    term580 = (4/3)*term516
    term581 = term256*term578
    term582 = term223*(-term339*term575 - term516*term573 - term572 - term574 - term576 - term577 - term578*term580 - term579 - term581)
    term583 = term45*term84
    term584 = term199*term77
    term585 = term202*term77
    term586 = term217*term84
    term587 = term0*(-term106*term188 - term106*term509 - term198*term512 - term201*term512 - term204*term93 - term206*term93 + term220*term356 + term356*term44 - term583 - term584 - term585 - term586)
    term588 = term176*term77
    term589 = term180*term77
    term590 = term268*term77
    term591 = term271*term77
    term592 = term180*term287
    term593 = term176*term324
    term594 = term271*term287
    term595 = term306*term317
    term596 = term306*term320
    term597 = p1*term281
    term598 = L2*(term106*term317 + term106*term320 - term169*y1 + term175*y1 + term276*term324 + term276*term93 + term281*term472 + term306*term597 - term505*x1 + term588 + term589 - term590 - term591 + term592 + term593 - term594 + term595 + term596)
    term599 = term236*term84
    term600 = term349*term512
    term601 = term353*term512
    term602 = term236*term306
    term603 = term356*term393
    term604 = term350*term77
    term605 = term354*term77
    term606 = term324*term350
    term607 = term324*term354
    term608 = term390*term84
    term609 = term306*term390
    term610 = term146*(-term106*term241 - term106*term394 - term241*term306 + term244*x1 - term287*term529 - term287*term530 - term298*term334 - term298*term517 - term306*term394 - term324*term359 - term324*term361 - term334*term84 - term359*term93 - term361*term93 - term517*term84 - term529*term77 - term530*term77 - term599 - term600 - term601 - term602 + term603 - term604 - term605 - term606 - term607 - term608 - term609)
    term611 = term419*term84
    term612 = 4*term107
    term613 = term352*term477
    term614 = 2*term34
    term615 = term324*term435
    term616 = s2*term107
    term617 = term106*term287
    term618 = term469*term77
    term619 = term535*term77
    term620 = 4*term287
    term621 = 4*term298
    term622 = term443*term466
    term623 = term451*term490
    term624 = L2*(-term134*term466*term616 - term298*term352*term612*term84 + term324*term356*term432 + term352*term561 - term352*term563 + term356*term418 - term388*term622 + term432*term564 - term432*term565 - term433*term490 - term433*term567 - term433*term621*term77 - term434*term620 - term435*term566 - term437*term620 - term451*term617 - term479*term512 - term512*term615 - term562*term613 - term611 - term613*term614 - term616*term622 - term618 - term619 - term623)
    term625 = L1*term20
    term626 = L2*term169
    term627 = term287*term73
    term628 = L2*term281
    term629 = -term627 - term628
    term630 = L1*(term91 + term96)
    term631 = term0*(term15 + term29)
    term632 = term146*(term163 + term183)
    term633 = L2*(term296 + term311 + term322 + term330)
    term634 = term0*(ddt1*term15 + ddt1*term29 + p1*term540 + p1*term541 + p2*term15 + p2*term29 + term13*term21 + term13*term5 + term17*term21 + term17*term5)
    term635 = s1*term548
    term636 = term189*term8
    term637 = (2/3)*term24
    term638 = term100*term17
    term639 = term33*(-p1*term550 - p1*term552 - p1*term554 - term100*term13*term637 - term40*term635 - term40*term636 - term42*term635 - term42*term636 - term637*term638)
    term640 = term66*y1
    term641 = term69*y1
    term642 = term26*y1
    term643 = term71*y1
    term644 = term488*term64
    term645 = p1*term124
    term646 = p1*term557 - p1*term558 + p1*term559 + p2*term91 + p2*term96 + term17*term78 + term17*term89 - term20*x2
    term647 = L1*(-term124*term81 + term25*x2 - 2*term640 - 2*term641 + 2*term642 + 2*term643 + 2*term644 - term645*term74 + term646)
    term648 = term113*term121
    term649 = term123*term80
    term650 = term134*term60
    term651 = term109*x1 - term114*term650 - term117*term99 - term122*term143 + term132*x1 - term136*term638
    term652 = L1*(-term111*x1 + term115*term138 + term118*term140 - term126*term649 - term127*term649 - term129*x1 - term411*term53 - 3*term648 + term651)
    term653 = term146*(ddt1*term163 + ddt1*term183 + ddt2*term163 + ddt2*term183 + dt2*term543 + dt2*term545 + p1*term543 + p1*term544 + p1*term545 + p1*term546 + p2*term163 + p2*term183 + term13*term151 + term13*term170 + term151*term165 + term151*term17 + term165*term170 + term17*term170)
    term654 = term199*y1
    term655 = term202*y1
    term656 = term204*y1
    term657 = term206*y1
    term658 = -p1*term583 - p1*term584 - p1*term585 - p1*term586 + term188*x1 - term196*term198 - term196*term201 - term212*term220 - term212*term44 + term45*x1
    term659 = term0*(-term190*x1 - term192*x1 - 2*term654 - 2*term655 - 2*term656 - 2*term657 + term658)
    term660 = s2*term570
    term661 = (1/3)*term155
    term662 = term338*term661
    term663 = (2/3)*term578
    term664 = term223*(-dt2*term572 - dt2*term574 - dt2*term576 - dt2*term577 - dt2*term579 - dt2*term581 - p1*term572 - p1*term576 - p1*term579 - term13*term662 - term165*term662 - term232*term660 - term262*term663 - term347*term661 - term40*term660 - term42*term660 - term57*term663 - term60*term663)
    term665 = term268*y1
    term666 = term271*y1
    term667 = term274*y1
    term668 = term176*y1
    term669 = term180*y1
    term670 = term276*y1
    term671 = term280*term64
    term672 = term124*term281
    term673 = ddt1*term311 + ddt1*term330 + dt2*term595 + p1*term588 + p1*term589 - p1*term590 - p1*term591 + p1*term592 + p1*term593 - p1*term594 + p1*term595 + p1*term596 + p2*term296 + p2*term311 + p2*term322 + p2*term330 + term13*term288 + term13*term314 - term169*x2 + term17*term278 + term17*term288 + term17*term303 + term17*term314 + term176*term363 - term268*term363 + term317*term472 + term320*term472
    term674 = L2*(-dt1*term672 - dt2*term672 + term175*x2 - term281*term645 - 2*term665 - 2*term666 - 2*term667 + 2*term668 + 2*term669 + 2*term670 + 2*term671 + term673)
    term675 = dt2*term356
    term676 = term350*y1
    term677 = term354*y1
    term678 = dt2*term600
    term679 = dt2*term601
    term680 = term359*y1
    term681 = term361*y1
    term682 = term17*term244
    term683 = term287*term57
    term684 = -p1*term599 - p1*term602 - p1*term604 - p1*term605 - p1*term606 - p1*term607 - p1*term608 - p1*term609 - term196*term349 - term196*term353 - term212*term393 - term236*term299 + term236*x1 - term241*term299 - term241*term375 + term241*x1 - term245*term298 - term298*term682 - term299*term390 - term299*term394 + term334*x1 - term345*term359 - term345*term361 - term349*term481 - term349*term683 - term350*term363 - term353*term481 - term353*term683 - term354*term363 - term359*term363 - term361*term363 - term375*term394 - term393*term396 - term393*term399 - term682*term84
    term685 = term146*(-term335*term675 - term336*x1 - term341*x1 - 2*term676 - 2*term677 - 2*term678 - 2*term679 - 2*term680 - 2*term681 + term684)
    term686 = term416*term429
    term687 = term287*term80
    term688 = term298*term80
    term689 = term435*term443
    term690 = s2*term430
    term691 = term489*term690
    term692 = -p1*term611 - p1*term618 - p1*term619 - p1*term623 - term117*term352 - term137*term352 - term142*term690 - term196*term479 - term196*term615 - term212*term418 + term413*x1 + term419*x1 + term423*x1 - term432*term482 - term435*term650 + term440*x1 - term443*term445*term454 - term446*term613 - term451*term473 + term459*x1 + term464*x1 - term57*term613 - term57*term689 - term57*term691 - term60*term613 - term60*term689 - term60*term691
    term693 = L2*(-term251*term411 - term414*x1 + term417*term427 - term421*x1 - term424*x1 + term426*term466 - term433*term688 - term434*term80 - term436*term687 - term437*term80 - term438*x1 - term451*term688 - term454*term687 - term456*x1 - term461*x1 - 3*term686 + term692)
    term694 = L1*(term501 + term502)
    term695 = L2*(term504 + term506 + term507)
    term696 = term0*(term190 + term192 + term510)
    term697 = L1*(term111 - term113*term525 + term129 + term513*term53)
    term698 = term146*(term336 + term339 + term341 + term518)
    term699 = L2*(term251*term513 + term414 - term416*term532 + term421 + term424 + term438 + term456 + term461)
    term700 = term0*(p1*term10 + term11 + term27 + term71*term8)
    term701 = term146*(p1*term157 + term155*term276 + term158 + term161 + term177 + term181)
    term702 = term33*(term107*term36 + term188*term46 + term256*term54 + term37 + term47 + term55)
    term703 = L1*(term106*term69 - term20*x1 + term25*x1 + term318*term74 + term556*y1 - term85 + term87 + term94)
    term704 = term134*term562
    term705 = L1*(term113*term568 - term114*term564 + term114*term565 + term122*term123*term136 - term138*term561 + term53*term566 + term53*term704)
    term706 = term223*(term225*term516 + term226 + term229 + term237*term334 + term238 + term242 + term252*term580 + term253 + term257)
    term707 = term0*(term106*term204 + term106*term206 + term189*term512 + term192*term93 + term194 - term198*term356 - term201*term356 + term208 + term210 + term218 + term220*term512 + term509*term93)
    term708 = L2*(term106*term274 - term169*x1 + term175*x1 + term274*term306 - term283 - term285 + term292 + term294 - term301 + term307 + term309 + term317*term93 + term320*term93 + term324*term597 + term325 + term328 + term505*y1 + term597*term93)
    term709 = term393*term512
    term710 = term146*(term106*term359 + term106*term361 + term287*term339 + term287*term517 + term298*term529 + term298*term530 + term306*term359 + term306*term361 + term324*term341 + term324*term394 + term338*y1 + term339*term77 + term341*term93 + term343 - term349*term356 - term353*term356 + term365 + term371 + term373 + term382 + term384 + term391 + term394*term93 + term404 + term517*term77 + term529*term84 + term530*term84 + term709)
    term711 = term430*term477
    term712 = L2*(term136*term430*term616 + term251*term287*term612*term77 + term251*term566 + term251*term704 - term356*term479 - term356*term615 + term388*term711 + term420*term512 - term432*term561 + term434*term621 - term435*term564 + term435*term565 + term436*term490 + term436*term567 + term436*term620*term84 + term437*term621 + term441 + term444*term562 + term444*term614 + term454*term617 + term460*term512 + term470 + term475 + term491 + term616*term711)
    term713 = L1*term25
    term714 = L2*term175
    term715 = term0*(-term21 - term5)
    term716 = L1*(-term78 - term89)
    term717 = term146*(-term151 - term170)
    term718 = L2*(-term278 - term288 - term303 - term314)
    term719 = L1*(term105 + term112 - term114*term411 + term120 + term130 + term135 + term139 + term144 - term526*x1 - term527*x1) + L1*(term501*y1 + term502*y1 - term65 - term67 + term68 - term70 + term72 + term75 - term79 - term86 + term88 - term90 + term92 + term95 + term97) + term0*(term12 + term16 + term18 - term22 - term23 + term28 + term30 + term31 - term6 - term7) + term0*(term191 + term193 + term195 + term197 - term200 - term203 - term205 - term207 + term209 + term211 + term213 + term214 + term217*y1 + term219 + term221 + term509*y1) + term33*(term38 + term41 + term43 + term48 + term50 + term51 + term56 + term59 + term62)
    term720 = (1/2)*term719
    term721 = L1*(term138*term411 - term526*y1 - term527*y1 - term648 + term651) + L1*(-term501*x1 - term502*x1 - term640 - term641 + term642 + term643 + term644 + term646) + term0*(term217*x1 + term509*x1 - term654 - term655 - term656 - term657 + term658) + term634 + term639
    term722 = (1/2)*term721
    term723 = s1*((3/4)*L1 + R*cos(t1))/sqrt(term719**2 + term721**2)
    term724 = (3/4)*L2
    term725 = term155*term724 + term298 + term84
    term726 = term725**2
    term727 = term148*term724 + term287 + term77
    term728 = term726 + term727**2
    term729 = sqrt(term728)
    term730 = 1/term729
    term731 = term147 + acos(term725*term730)
    term732 = sin(term731)
    term733 = (3/2)*L2
    term734 = (1/2)*term727*(-term106 - term155*term733 - term306)
    term735 = (1/2)*term725*(term148*term733 + term324 + term93)
    term736 = L2*(-term411*term435 + term412 + term415 + term422 + term425 + term428 + term431 + term439 + term442 + term447 + term448 + term449 + term450 + term457 + term462 + term465 + term468 - term469*x1 + term471 + term474 + term476 + term478 + term480 + term483 + term484 + term486 + term487 + term492 + term494 + term495 - term533*x1 - term534*x1 - term535*x1 - term536*x1 - term537*x1) + L2*(-term267 - term269 + term270 - term272 + term273 - term275 + term277 - term279 + term282 - term284 - term286 - term289 - term290 + term293 + term295 + term297 - term300 - term302 - term304 + term305 + term308 + term310 + term312 + term313 - term315 - term316 + term319 + term321 + term323 + term326 + term327 + term329 + term331 + term332 + term504*y1 + term506*y1 + term507*y1) + term146*(-term152 - term153 - term154 + term159 + term160 + term162 + term164 + term166 + term167 - term171 - term172 - term173 + term178 + term179 + term182 + term184 + term185 + term186) + term146*(dt2*term709 + term337 + term340 + term342 + term344 + term346 + term348 - term349*term675 - term351 - term353*term675 - term355 - term360 - term362 + term364 + term366 + term367 + term369 + term370 + term372 + term374 + term376 + term377 + term378 + term379 + term380 + term381 + term383 + term385 + term386 + term387 + term390*y1 + term392 + term394*y1 + term395 + term397 + term398 + term400 + term401 + term402 + term403 + term405 + term406 + term408 + term409) + term223*(term227 + term228 + term230 + term231 + term233 + term234 + term239 + term240 + term243 + term247 + term249 + term250 + term254 + term255 + term258 + term261 + term263 + term265)
    term737 = L2*(term411*term432 - term469*y1 - term533*y1 - term534*y1 - term535*y1 - term536*y1 - term537*y1 - term686 + term692) + L2*(-term504*x1 - term506*x1 - term507*x1 - term665 - term666 - term667 + term668 + term669 + term670 + term671 + term673) + term146*(dt2*term603 + term390*x1 + term394*x1 - term676 - term677 - term678 - term679 - term680 - term681 + term684) + term653 + term664
    term738 = sqrt(term736**2 + term737**2)
    term739 = s2*term729
    term740 = (1/2)*term736
    term741 = (1/2)*term737
    term742 = term732*term739/term738
    term743 = 2*term522 + 2*term523 + 2*term528
    term744 = 2*term524 + 2*term531 + 2*term538

    # Now the remaining elements of `dfdy`
    df3dx = 0
    df3dy = 0
    df3dp = -term145 - term187 - term222 - term266 - term32 - term333 - term410 - term496 - term63 - term98
    df3dx1 = term116*term499 + term498 - term503 - term508 - term511 - term515 - term519 - term521
    df3dy1 = term539
    df3dp1 = -term542 - term547 - term555 - term560 - term569 - term582 - term587 - term598 - term610 - term624
    df3dx2 = Mv + term625 + term626
    df3dy2 = term629
    df3dp2 = -term630 - term631 - term632 - term633
    df4dx = 0
    df4dy = 0
    df4dp = -term634 - term639 - term647 - term652 - term653 - term659 - term664 - term674 - term685 - term693
    df4dx1 = term539
    df4dy1 = term103*term499 + term498 - term694 - term695 - term696 - term697 - term698 - term699
    df4dp1 = -term700 - term701 - term702 - term703 - term705 - term706 - term707 - term708 - term710 - term712
    df4dx2 = term629
    df4dy2 = Mv + term713 + term714
    df4dp2 = -term715 - term716 - term717 - term718
    df5dx = 0
    df5dy = 0
    df5dp = -s2*term730*term732*term738*(term734 + term735) - term723*(term720*(2*term634 + 2*term639 + 2*term647 + 2*term652 + 2*term659) + term722*(2*term145 + 2*term222 + 2*term32 + 2*term63 + 2*term98)) - term738*term739*(1 - (term725*(-term734 - term735)/term728**(3/2) + term727*term730)/sqrt(-term726/term728 + 1))*cos(term731) - term742*(term740*(2*term653 + 2*term664 + 2*term674 + 2*term685 + 2*term693) + term741*(2*term187 + 2*term266 + 2*term333 + 2*term410 + 2*term496))
    df5dx1 = -term723*(term720*term743 + term722*(2*term503 + 2*term511 + 2*term515)) - term742*(term740*term744 + term741*(2*term508 + 2*term519 + 2*term521))
    df5dy1 = -term723*(term720*(2*term694 + 2*term696 + 2*term697) + term722*term743) - term742*(term740*(2*term695 + 2*term698 + 2*term699) + term741*term744)
    df5dp1 = Z3*s3*term445 - term723*(term720*(2*term700 + 2*term702 + 2*term703 + 2*term705 + 2*term707) + term722*(2*term542 + 2*term555 + 2*term560 + 2*term569 + 2*term587)) - term742*(term740*(2*term701 + 2*term706 + 2*term708 + 2*term710 + 2*term712) + term741*(2*term547 + 2*term582 + 2*term598 + 2*term610 + 2*term624))
    df5dx2 = -term723*(-term625*term721 + term627*term719) - term742*(-term626*term737 + term628*term736)
    df5dy2 = -term723*(term627*term721 - term713*term719) - term742*(term628*term737 - term714*term736)
    df5dp2 = Iv - term723*(term720*(2*term715 + 2*term716) + term722*(2*term630 + 2*term631)) - term742*(term740*(2*term717 + 2*term718) + term741*(2*term632 + 2*term633))

    # Fill the jacobian matrices
    dfdy[3,0] = df3dx
    dfdy[3,1] = df3dy
    dfdy[3,2] = df3dp
    dfdy[3,3] = df3dx1
    dfdy[3,4] = df3dy1
    dfdy[3,5] = df3dp1
    dfdy[4,0] = df4dx
    dfdy[4,1] = df4dy
    dfdy[4,2] = df4dp
    dfdy[4,3] = df4dx1
    dfdy[4,4] = df4dy1
    dfdy[4,5] = df4dp1
    dfdy[5,0] = df5dx
    dfdy[5,1] = df5dy
    dfdy[5,2] = df5dp
    dfdy[5,3] = df5dx1
    dfdy[5,4] = df5dy1
    dfdy[5,5] = df5dp1

    dfdyp[3,0] = df3dx1
    dfdyp[3,1] = df3dy1
    dfdyp[3,2] = df3dp1
    dfdyp[3,3] = df3dx2
    dfdyp[3,4] = df3dy2
    dfdyp[3,5] = df3dp2
    dfdyp[4,0] = df4dx1
    dfdyp[4,1] = df4dy1
    dfdyp[4,2] = df4dp1
    dfdyp[4,3] = df4dx2
    dfdyp[4,4] = df4dy2
    dfdyp[4,5] = df4dp2
    dfdyp[5,0] = df5dx1
    dfdyp[5,1] = df5dy1
    dfdyp[5,2] = df5dp1
    dfdyp[5,3] = df5dx2
    dfdyp[5,4] = df5dy2
    dfdyp[5,5] = df5dp2

    jac = dfdy + c*dfdyp

    return jac
